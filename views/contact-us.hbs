{{> page-header}}
<div class="container">
    <p>We are always open letting people know more about our program and what is involved in becoming a foster parent.
        Feel free to use our contact form, email us directly or give us a call.</p>

            <form id="contact-form" name="contact-form">
                <input type="hidden" id="csrf-token" name="_csrf" value="{{csrfToken}}">
    <div class="card contact-form">
        <div class="card-content">
            <span class="card-title">Contact Form</span>
            <span>All fields are required to submit the contact form.</span>
                <div class="row">
                    <div class="input-field col s12 m6">
                        <input type="text" id="first-name" name="first-name" class="validate" pattern=".{2,}" required>
                        <label for="first-name">First Name</label>
                        <span class="helper-text" data-error="Must be two or more characters" data-success=""></span>
                    </div>
                    <div class="input-field col s12 m6">
                        <input type="text" id="last-name" name="last-name" class="validate" pattern=".{2,}" required>
                        <label for="last-name">Last Name</label>
                        <span class="helper-text" data-error="Must be two or more characters" data-success=""></span>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12 l6">
                        <input type="email" id="email" name="email" class="validate" required>
                        <label for="email">Email</label>
                        <span class="helper-text" data-error="Must be a valid email address" data-success=""></span>
                    </div>
                    <div class="input-field col s12 l6">
                        <select name="subject" id="subject" value="Foster Parenting">
                            <option value="Foster Parenting" selected>Foster Parenting</option>
                            <option value="Employment">Employment</option>
                            <option value="General Inquiry">General Inquiry</option>
                        </select>
                        <label for="subject">Subject</label>
                    </div>
                </div>
                <div class="row">
                    <div class="col s12">
                        <textarea name="message" id="message" class="materialize-textarea validate" pattern=".{2,}" required></textarea>
                        <label for="message">Message</label>
                        <span class="helper-text" data-error="Must have two or more characters" data-success=""></span>
                    </div>
                </div>
        </div>
        <div class="card-action">
                <button id="submit-button" disabled class="g-recaptcha btn waves-effect waves-light disabled" data-sitekey="6Ld8uFUpAAAAAAGsf6jYup0tnHbbsbbFki_9PPqX" data-callback='onSubmit' data-action='submit' type="button">Submit <i class="material-symbols-outlined right" aria-hidden="true">send</i></button>
                <span id="submit-spinner" class="preloader-wrapper small active" style="display:none; vertical-align: middle; margin-left: 0.5rem;">
                    <span class="spinner-layer spinner-white-only">
                        <span class="circle-clipper left">
                            <span class="circle"></span>
                        </span>
                        <span class="gap-patch">
                            <span class="circle"></span>
                        </span>
                        <span class="circle-clipper right">
                            <span class="circle"></span>
                        </span>
                    </span>
                </span>
        </div>
    </div>
            </form>


    <div class="divider" id="contact"></div>

    <div class="row">
        <div class="col s12 l6">
            <div class="card contact-card">
                <div class="card-image">
                    <img src="/images/contact-us.jpg"
                        alt="contact us icons">
                </div>
                <div class="card-content">
                    <span class="card-title">Contact Us</span>
                    <div class="row">
                        <div class="col s2 m1">
                            <i class="material-symbols-outlined" aria-hidden="true">phone</i>
                        </div>
                        <div class="col s10 m11">
                            <p style="font-size: 1.2rem; line-height: 1.5rem;"><strong>(905)
                                    294-2137</strong></p>
                            <p>New Foster Homes @ ext. 5</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s2 m1">
                            <i class="material-symbols-outlined" aria-hidden="true">email</i>
                        </div>
                        <div class="col s10 m11">
                            <p style="font-size: 1.2rem; line-height: 1.5rem;"><strong><a
                                        href="mailto:amanda.west@annieshavens.ca">New Home Inquiries</a></strong></p>
                            <p><a href="mailto:alexis.mcneil@annieshavens.ca"><strong>Alexis McNeil</strong> Compliance Manager</a></p>
                            <p><a href="mailto:chriswilson@annieshavens.ca"><strong>Chris Wilson</strong> Executive Director</a></p>
                            <p><a href="mailto:faith.buckingham@annieshavens.ca"><strong>Faith Buckingham</strong> Case Manager</a></p>
                            <p><a href="mailto:jamie.moreau@annieshavens.ca"><strong>Jamie Moreau</strong> Director of Children's Services</a></p>
                            <p><a href="mailto:jason.dove@annieshavens.ca"><strong>Jason Dove</strong> Case Manager</a></p>
                            <p><a href="mailto:lillian.white@annieshavens.ca"><strong>Lillian White</strong> Case Manager</a></p>
                            <p><a href="mailto:michellepotvin@annieshavens.ca"><strong>Michelle Potvin</strong> Placement Coordinator / Case Manager</a></p>
                            <p><a href="mailto:oksana.fedan@annieshavens.ca"><strong>Oksana Fedan</strong> Director of Service Development</a></p>
                            <p><a href="mailto:sherry.flood@annieshavens.ca"><strong>Sherry Flood</strong> Case Manager</a></p>
                            <p><a href="mailto:tracygodden@annieshavens.ca"><strong>Tracy Godden</strong> Case Manager / Area Manager</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col s12 l6">
            <div class="card contact-card">
                <div class="card-image">
                    <img src="/images/location-2.jpg"
                        alt="map to office">
                </div>
                <div class="card-content">
                    <span class="card-title">Location</span>
                    <div class="row">
                        <div class="col s2 m1">
                            <i class="material-symbols-outlined" aria-hidden="true">location_on</i>
                        </div>
                        <div class="col s10 m11">
                            <p>517 Upper Sherman Ave.</p>
                            <p>Hamilton, Ontario</p>
                            <p>L8V 3L7</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

{{!-- Read More --}}
{{> read-more}}

{{#section 'script'}}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const materialize = window.M;

        // Form Select
        const formSelects = document.querySelectorAll('select');
        if (formSelects.length && materialize?.FormSelect) {
            materialize.FormSelect.init(formSelects, {});
        }

        // Submit Button
        const submitButton = document.getElementById('submit-button');
        submitButton.disabled = true;

        // Contact Us Form
        const contactForm = document.querySelector('#contact-form');

        // Variables
        var isValid = false;
        var isSubmitting = false;

        const subject = contactForm.querySelector('#subject');

        // Form Inputs
        const firstName = document.querySelector('#first-name');
        const lastName = document.querySelector('#last-name');
        const email = document.querySelector('#email');
        const csrfToken = document.querySelector('#csrf-token');
        const message = document.querySelector('#message');

    // Validation
    var firstNameValidation = {
        valid: false,
        touched: false,
        message: ''
    };
    firstName.addEventListener('blur', () => {
        firstNameValidation.touched = true;
        if(firstName.value.length > 2) {
            firstNameValidation.valid = true;
            firstNameValidation.message = '';
        } else {
            firstNameValidation.valid = false;
            firstNameValidation.message = 'Must be 2 or more characters'
        }
        validateForm();
    });

    var lastNameValidation = {
        valid: false,
        touched: false,
        message: ''
    };
    lastName.addEventListener('blur', () => {
        lastNameValidation.touched = true;
        if(lastName.value.length > 2) {
            lastNameValidation.valid = true;
            lastNameValidation.message = '';
        } else {
            lastNameValidation.valid = false;
            lastNameValidation.message = 'Must be 2 or more characters';
        }
        validateForm();
    });

    var emailValidation = {
        valid: false,
        touched: false,
        message: ''
    };
    email.addEventListener('blur', () => {
        emailValidation.touched = true;
        const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        if(re.test(String(email.value).toLowerCase())) {
            emailValidation.valid = true;
            emailValidation.message = '';
        } else {
            emailValidation.valid = false;
            emailValidation.message = 'Please provide a valid email address';
        }
        validateForm();
    });

    var messageValidation = {
        valid: false,
        touched: false,
        message: ''
    };
    message.addEventListener('keyup', () => {
        messageValidation.touched = true;
        if(message.value.length > 1) {
            messageValidation.valid = true;
            messageValidation.message = '';
        } else {
            messageValidation.valid = false;
            messageValidation.message = 'Please enter a message';
        }
        validateForm();
    });

    function setSubmitting(submitting) {
        isSubmitting = submitting;
        const submitSpinner = document.getElementById('submit-spinner');
        submitSpinner.style.display = submitting ? 'inline-block' : 'none';
        submitButton.disabled = submitting || !isValid;
        submitButton.classList.toggle('disabled', submitButton.disabled);
    }

    function validateForm() {
        if(
            firstNameValidation.valid &&
            lastNameValidation.valid &&
            emailValidation.valid &&
            messageValidation.valid
        ) {
            isValid = true;
            if (!isSubmitting) {
                submitButton.disabled = false;
                submitButton.classList.remove('disabled');
            }
        } else {
            isValid = false;
            submitButton.disabled = true;
            submitButton.classList.add('disabled')
        }
    }

    window.onSubmit = function onSubmit(token) {
        console.log('Submit in progress');

        setSubmitting(true);
        fetch('/contact-us', {
            method: 'POST',
            credentials: 'same-origin',
            headers: {
                'Accept': 'application/json, text/plain, */**',
                'Content-Type': 'application/json',
                'x-csrf-token': csrfToken.value
            },
            body: JSON.stringify({
                firstName: firstName.value,
                lastName: lastName.value,
                email: email.value,
                subject: subject.value,
                message: message.value,
                _csrf: csrfToken.value,
                token
            })
        })
            .then((res) => res.json())
            .then((data) => {
                if (data && (data.success === true || data.delivered === true)) {
                    contactForm.reset();
                    // M.toast({html: "Thanks! We'll be getting back to you soon.", displayLength: 5000});
                    window.location.href = '/contact-success';
                    return;
                }
                const message = (data && data.message) ? data.message : 'There was a problem submitting the form.';
                materialize?.toast({ html: message });
            })
            .catch(() => {
                materialize?.toast({ html: 'There was a problem submitting the form. Please try again.' });
            })
            .finally(() => {
                setSubmitting(false);
            });
    };
    });
</script>
{{/section}}